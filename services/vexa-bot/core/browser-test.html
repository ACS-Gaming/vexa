<!DOCTYPE html>
<html>
<head>
    <title>Teams Bot Browser Test</title>
    <script src="dist/browser-utils.global.js"></script>
</head>
<body>
    <h1>Teams Bot Browser Test</h1>
    <div id="status">Loading...</div>
    <div id="audio-status">Audio: Not connected</div>
    <div id="transcription">Transcription: Waiting...</div>
    
    <script>
        const { BrowserAudioService, BrowserWhisperLiveService, generateBrowserUUID } = window.VexaBrowserUtils;
        
        // Mock bot config
        const botConfig = {
            language: null,
            task: "transcribe",
            platform: "teams",
            token: "debug-token",
            nativeMeetingId: "test-meeting-123",
            meetingUrl: "https://teams.live.com/meet/test"
        };
        
        // Mock log function
        window.logBot = (message) => {
            console.log(message);
            document.getElementById('status').innerHTML += '<br>' + message;
        };
        
        // Test audio service
        const audioService = new BrowserAudioService({
            targetSampleRate: 16000,
            bufferSize: 4096,
            inputChannels: 1,
            outputChannels: 1
        });
        
        // Test WhisperLive service
        const whisperService = new BrowserWhisperLiveService({
            whisperLiveUrl: "ws://localhost:9090/ws" // Change to your WhisperLive URL
        }, true);
        
        document.getElementById('status').innerHTML = 'Browser utilities loaded successfully!';
        
        // Test connection
        whisperService.connectToWhisperLive(
            botConfig,
            (data) => {
                document.getElementById('transcription').innerHTML = 'Transcription: ' + JSON.stringify(data);
            },
            (error) => {
                document.getElementById('status').innerHTML += '<br>Error: ' + error;
            },
            (event) => {
                document.getElementById('status').innerHTML += '<br>Connection closed: ' + event.code;
            }
        );
        
        // Test audio data sending
        function testAudioData() {
            const testAudio = new Float32Array(1024);
            for (let i = 0; i < testAudio.length; i++) {
                testAudio[i] = Math.sin(2 * Math.PI * 440 * i / 16000); // 440Hz tone
            }
            
            const success = whisperService.sendAudioData(testAudio);
            document.getElementById('audio-status').innerHTML = 'Audio: ' + (success ? 'Sent successfully' : 'Failed to send');
        }
        
        // Test every 2 seconds
        setInterval(testAudioData, 2000);
    </script>
</body>
</html>
